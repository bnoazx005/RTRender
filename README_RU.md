**Название**:            RTRender

**Автор**:                   Kasimov Ildar

**e-mail**:                   ildar2571@yandex.ru 

**Версия**:                 1.0

**Замечание**:  

Некоторые файлы проекта содержат части кода из других исходников.  Если некоторый файл проекта
содержит подобный код, то эта ситуация указана в месте его использования.

Название RTRender является сокращением от Ray Tracing Render.

**Описание**:

RTRender является моим образовательным проектом, который разрабатывался в процессе выполнения
курсовой работы.  Основная его особенность - это поддержка параллелизма.  Программа позволяет 
использовать MPI, OpenMP. Также доступен последовательный режим выполнения. В качестве структу
ры ускорения процесса рендеринга в проекте применяется метод иерархии ограничивающих объемов
(BVH Tree).

**Начало работы**: 
       
Проект был разработан с использованием среды Microsoft Visual Studio 2013 Community. 
Если вы используете эту версию Visual Studio, то вам можно просто собрать проект.  Результатом 
построения будет исполняемый файл программы. Также последняя версия предварительно скомпили-
рованной программы расположена в директории Builds/.
       
Проект основан на применении библиотеки Microsoft MPI SDK (msmpi.dll). Если вам необходимо полу-
чить все возможности программы, то требуется установить Microsoft MPI SDK. Или использовать 
библиотеку msmpi.dll , которая располагается вместе с исполняемым файлом. Однако у вас будет 
отсутствовать возможность управления процессом выполнения программы в режиме MPI.

Для получения изображения данной программой необходимо предварительно подготовить xml файл
конфигурации сцены.  Также треуется создать и отредактировать файл конфигурации программы.
Данный файл обязательно должен иметь имя config.xml. Для файла, описывающего сцену, имя заранее
не задано и является произвольным. Более подробно синтаксис для описания данных файлов представ-
лен в разделе "Работа с файлами программы".

**Поддерживаемые платформы**: 

Основной платформой проекта на даннный момент является Microsoft Windows OS.  Но большая часть
исходного кода являестя кроссплатформенной.  Основная часть, зависящая от ОС, - MPI. Поэтому для
устранения этой проблемы необходимо переписать код,использующий Microsoft MPI SDK. MPICH будет
наилучшим выбором для UNIX систем.

**Работа с файлами программы**:

Для подготовки программы к визуализации требуется создать два файла, описывающих текущие настрой-
ки работы. Первый файл config.xml является файлом конфигурации программы. Второй файл имеет про-
извольное имя и предназначается для описания визуализируемой сцены.

Файл конфигурации программы является обязательным для ее запуска. Неправильно описанный файл 
или его отсутствие приведет к возниковению ошибки, после которой выполнение программмы пре-
кратится. Шаблон файла конфигурации имеет следующий вид:

```xml
<?xml version="1.0" ?>

<config>

    <render type = "OMP" scheme="2" max_depth  = "4" />
    <camera type = "perspective" pos = "0.0;0.0;-1.0" target = "0.0;0.0;0.0" fov = "45.0" width="640" height="480" />
    <result type = "tga" path="." name = "result" />

    <scene path = "scene_1.xml" bg_color = "0.0;0.0;0.5">
        <bvh use = "true" max_depth = "64" />
    </scene>

</config>
```

=========================================================================================

Основной секцией является `<config>` все остальные должны располагаться внутри нее.

Секция `<render>` содержит информацию о настройках трассировщика лучей. Обязательно должен содерж-
ать следующие атрибуты: type, scheme, max_depth.

                 Attribute name | Valid values                     | Description 
                ------------------ | ------------------------   | --------------
                 type                      | OMP, MPI, Sequential | Значения, которые может принимать атрибут type.         
                 scheme                | UINT                                | Тип схемы распределения вычислений. Для предварительно собранной программы в папке Builds scheme может принимать значения либо 1, либо 2               
                 max_depth         | UINT                                | Максимальная глубина рекурсии в процессе трассировки луча. Слишком большие значения могут приводить к зависанию или переполнению стека вызовов.
                
Секция `<camera>` содержит информацию о камере. Обязательно содержит следующие атрибуты: type, pos,
target, width, height. В зависимости от типа камеры могут присутствовать дополнительные атрибуты.

                 Attribute name                                         | Valid values            | Description 
                ------------------------------------------ | -------------------- | --------------
               type                                                                |  perspective            | Для данной скомпилированной программы доступна только камера перспективной проекции.              
               pos                                                                  | "float; float; float" | Задает положение камеры в пространстве.              
               target                                                             | "float; float; float" | Задает точку, на которую направлен взгляд.           
               width                                                             | UINT                       | Ширина итогового изображения.             
               height                                                            | UINT                       | Высота итогового изображения.               
               (additional for perspective camera) fov | float                         | Угол обзора камеры. Задается только при использовании перспективной проекции.
               
Секция `<result>` содержит инофрмацию о результирующем изображении. Основные атрибуты, используемые
в данной секции: type, path, name.

                 Attribute name | Valid values | Description 
                ------------------ | ------------ | --------------
              type                         | tga, ppm     |  Задает тип итогового изображения.              
              path                        | string          | Задает путь, по которому будет располагаться изображение.            
              name                      | string          | Задает имя результирующего изображения.
                            
Секция `<scene>` описывает настройки сцены. Обязательные атрибуты: path, bg_color. Обязательно должна
содержать вложенную секцию с информацией о BVH дереве.
    
             Attribute name | Valid values            | Description 
             ------------------ | ------------             | --------------
             path                     | string                       | Путь до файла с описанием сцены. Путь включает в себя и имя файла. Например: C:\Builds\OpenMP\scene1.xml.         
             bg_color             | "float; float; float" | Задает цвет фона сцены.
             
Секция `<bvh>` содержит информацию о иерархии ограничивающих объемов. Обязательные атрибуты: use, max_depth.
             
                            Attribute name | Valid values  | Description 
                            ------------------ | ------------ | --------------
                          use                           | true, false   | Задают использование структуры. Если false, то структура не используется.                         
                          max_depth            | UINT          | Максимальная высота строящегося дерева
                          
============================================================================================

Далее идет рассмотрение структуры файла описания сцены. Ниже приведен пример такого файла:

```xml
<?xml version="1.0" ?>

<scene>
  <materials>
    <material name = "std_diffuse" kd = "1.0" kr = "0.0" ks = "0.8" kt = "0.0" refract_coeff = "0.0" />    
    <material name = "std_transp" kd = "1.0" kr = "0.0" ks = "0.7" kt = "1.0" refract_coeff = "2.0" />
    <material name = "std_refl" kd = "1.0" kr = "0.4" ks = "0.9" kt = "0.0" refract_coeff = "0.0" />
    <material name = "mirror" kd = "1.0" kr = "0.8" ks = "0.9" kt = "0.0" refract_coeff = "0.0" />
  </materials>
  
  <lights>
    <light type = "point" pos = "60.0;150.0;60.0" color="1.0;1.0;1.0"/>
  </lights> 
  
  <primitives>                                                                                                         
     <primitive type = "mesh" path = ".\..\Models\floor.obj" material = "mirror" color = "0.7;0.0;0.0"/>
     <primitive type = "mesh" path = ".\..\Models\bunny.obj" material = "std_refl" color = "1.0;0.8;0.0"/>
     <primitive type = "mesh" path = ".\..\Models\mirror.obj" material = "mirror" color = "1.0;1.0;1.0"/>
     <primitive type = "sphere" center = "60.0;10.0;100.0" radius = "20.0" material = "std_transp" color = "1.0;1.0;1.0"/>
  </primitives>
</scene>            
```

Основной секцией является `<scene>`, все остальные располагаются внутри нее.

Секция `<materials>` содержит информацию о материалах сцены. Данная секция ОБЯЗАТЕЛЬНО
должна быть первой и содержать все материалы, используемые примитивами. Внутри секции
располагается подсекция `<material>` описывающая конкретный материал. Обязательные атрибуты:
name, kd, kr, ks, kt, refract_coeff.
              
                Attribute name | Valid values     | Description 
                ------------------ | ------------       | --------------       
              name                       | string               |  Имя материала.              
              kd                             | float in [0 .. 1] | Дифуззный коэффициент поверхности.              
              kr                             |float in  [0 .. 1]  | Зеркальный коэффициент поверхности.              
              ks                             | float in [0 .. 1]  | Отражательный коэффициент поверхности.              
              kt                             |float in  [0 .. 1]  | Коэффициент прозрачности.              
              refract_coeff         | float in [1 .. n]  | Коэффициент преломления. 
              
Секция `<lights>` содержит множество элементов `<light>`, описывающих источники света. 
Обязательные атрибуты элемента `<light>` : type, pos, color. Также могут присутствовать дополни-
тельные атрибуты.
            
              Attribute name | Valid values           | Description 
                ------------------ | ------------             | --------------            
              type                         | point                       | В данной программе реализован лишь точечный источник света. 
              pos                           | "float; float; float"| Положения источника света в пространстве.            
              color                       | "float; float; float" | Цвет источника.
                            
Секция `<primitives>` содержит множество элементов `<primitive>`, представляющий собой 
примитивы сцены. Обязательные атрибуты `<primitive>` type, material, color. В зависимости от
типа примитива могут присутствовать дополнительные атрибуты.
 
                Attribute name | Valid values                    | Description 
                ------------------ | ------------                      | -------------- 
               type                        | sphere, mesh, triangle | Тип примитива (сфера, треугольник, сетка треугольников).        
               material                | string                               | Имя материала, применяемого к данному примитиву.  Материал с указанным именем ДОЛЖЕН быть предварительно определен в секции `<materials>`.                
               color                      | "float; float; float"         |  Цвет примитива.
                              
Для сферы дополнительно определены: radius, center.
               
               Attribute name | Valid values            | Description 
                ----------------- | ------------              | -------------- 
               radius                   | float in (0, n)         | Радуис сферы.              
               center                  | "float; float; float" | Положение центра сферы в пространстве.
                              
Для сетки треугольников (mesh) определен атрибут path | путь к OBJ файлу, содержащему сетку треугольников.
               
Для треугольника задаются атрибуты его вершин: p0, p1, p2.
               
                Attribute name | Valid values            | Description 
                ------------------ | ------------             | -------------- 
               p0, p1, p2              | "float; float; float" | Координаты треугольника в пространстве.   
